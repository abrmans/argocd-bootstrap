#
# IMPORTANT NOTE
#
# This chart inherits from our common library chart. You can check the default values/options here:
# https://github.com/k8s-at-home/library-charts/tree/main/charts/stable/common/values.yaml
#
home-assistant:
  image:
  # -- image repository
    repository: homeassistant/home-assistant
  # -- image tag
    tag: 2021.6.3
  # -- image pull policy
    pullPolicy: IfNotPresent

# -- environment variables.
# @default -- See below
  env:
  # -- Set the container timezone
    TZ: America/Chicago

# -- Configures service settings for the chart. Normally this does not need to be modified.
# @default -- See values.yaml
  service:
    main:
      ports:
        http:
          port: 8123

  ingress:
    main:
    # -- Enables or disables the ingress
      enabled: true

    # -- Make this the primary ingress (used in probes, notes, etc...).
    # If there is more than 1 ingress, make sure that only 1 ingress is marked as primary.
      primary: true

    # -- Override the name suffix that is used for this ingress.
      nameOverride:

    # -- Provide additional annotations which may be required.
      annotations:
        kubernetes.io/ingress.class: nginx
      # kubernetes.io/tls-acme: "true"

    # -- Provide additional labels which may be required.
      labels: {}

    # -- Set the ingressClass that is used for this ingress.
    # Requires Kubernetes >=1.19
      ingressClassName:  # "nginx"

    ## Configure the hosts for the ingress
      hosts:
      -  # -- Host address. Helm template can be passed.
          host: home-assistant.kanebroslabs.com
        ## Configure the paths for the host
          paths:
            -  # -- Path.  Helm template can be passed.
              path: /
            # -- Ignored if not kubeVersion >= 1.14-0
              pathType: Prefix
              service:
              # -- Overrides the service name reference for this path
                name: 
              # -- Overrides the service port reference for this path
                port: 8123

    # -- Configure TLS for the ingress. Both secretName and hosts can process a Helm template.
      tls: []
    #  - secretName: chart-example-tls
    #    hosts:
    #      - chart-example.local


# -- Enable devices to be discoverable
# hostNetwork: true

# -- When hostNetwork is true set dnsPolicy to ClusterFirstWithHostNet
# dnsPolicy: ClusterFirstWithHostNet

  securityContext:
  # -- (bool) Privileged securityContext may be required if USB devics are accessed directly through the host machine
    privileged:  # true

# -- Configure persistence settings for the chart under this key.
# @default -- See values.yaml
  persistence:
    config:
      enabled: true
      storageClass: "longhorn"
      accessModes:
      - ReadWriteOnce
      ## @param persistence.size PVC Storage Request for PostgreSQL volume
      ##
      size: 1Gi
      ## @param persistence.annotations Annotations for the PVC
      ##
      annotations: {}
  ## @param persistence.selector Selector to match an existing Persistent Volume (this value is evaluated as a template)
      ## selector:
      ##   matchLabels:
      ##     app: my-app
      selector: {}
  # -- Configure a hostPathMount to mount a USB device in the container.
  # @default -- See values.yaml
    usb:
      enabled: false
      type: hostPath
      hostPath: /path/to/device

# -- Enable and configure mariadb database subchart under this key.
#    For more options see [mariadb chart documentation](https://github.com/bitnami/charts/tree/master/bitnami/mariadb)
# @default -- See values.yaml
  mariadb:
    enabled: false
    architecture: standalone
    auth:
      database: home-assistant
      username: home-assistant
      password: home-assistant-pass
      rootPassword: home-assistantrootpass
    primary:
      persistence:
        enabled: false
        # storageClass: ""

# -- Enable and configure postgresql database subchart under this key.
#    For more options see [postgresql chart documentation](https://github.com/bitnami/charts/tree/master/bitnami/postgresql)
# @default -- See values.yaml
  postgresql:
    enabled: true
    postgresqlUsername: home-assistant
    postgresqlPassword: home-assistant-pass
    postgresqlDatabase: home-assistant
    persistence:
      enabled: true
      storageClass: "longhorn"
      existingClaim: ""
      ## @param persistence.mountPath The path the volume will be mounted at, useful when using different
      ## PostgreSQL images.
      ##
      mountPath: /bitnami/postgresql
      ## @param persistence.subPath The subdirectory of the volume to mount to
      ## Useful in dev environments and one PV for multiple service
      accessModes:
        - ReadWriteOnce
      ## @param persistence.size PVC Storage Request for PostgreSQL volume
      ##
      size: 8Gi
      ## @param persistence.annotations Annotations for the PVC
      ##
      annotations: {}
  ## @param persistence.selector Selector to match an existing Persistent Volume (this value is evaluated as a template)
      ## selector:
      ##   matchLabels:
      ##     app: my-app
      selector: {}
## @param updateStrategy.type updateStrategy for PostgreSQL StatefulSet and its reads StatefulSets
## ref: https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#update-strategies
##
# -- Enable and configure influxdb database subchart under this key.
#    For more options see [influxdb chart documentation](https://github.com/bitnami/charts/tree/master/bitnami/influxdb)
# @default -- See values.yaml
  influxdb:
    enabled: false
    architecture: standalone
    database: home_assistant
    authEnabled: false
    persistence:
      enabled: false
      # storageClass: ""
      # size: 8Gi

  metrics:
    # -- Enable and configure a Prometheus serviceMonitor for the chart under this key.
    # @default -- See values.yaml
    enabled: false
    serviceMonitor:
      interval: 1m
      scrapeTimeout: 30s
      labels: {}
    ## See https://www.home-assistant.io/docs/authentication/ for where to find
    ## long lived access token creation under your account profile, which is
    ## needed to monitor Home Assistant
    # bearerTokenSecret:
    #   name: ""
    #   key: ""

    # -- Enable and configure Prometheus Rules for the chart under this key.
    # @default -- See values.yaml
    prometheusRule:
      enabled: false
      labels: {}
      # -- Configure additionial rules for the chart under this key.
      # @default -- See prometheusrules.yaml
      rules: []
      # - alert: HomeAssistantAbsent
      #   annotations:
      #     description: Home Assistant has disappeared from Prometheus service discovery.
      #     summary: Home Assistant is down.
      #   expr: |
      #     absent(up{job=~".*home-assistant.*"} == 1)
      #   for: 5m
      #   labels:
      #     severity: critical
